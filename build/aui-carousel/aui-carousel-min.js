AUI.add("aui-carousel",function(q){var e=q.Lang,p=" ",k="carousel",B=q.getClassName,m=B(k,"item"),d=B(k,"item","active"),z=B(k,"item","transition"),b=B(k,"menu","active"),t=B(k,"menu","index"),j=B(k,"menu","item"),c=B(k,"menu","next"),i=B(k,"menu","play"),r=B(k,"menu","pause"),a=B(k,"menu","prev"),w=[j,t].join(p),g=[j,t,b].join(p),s=".",h=s+t,o=s+c,f=s+r,v=s+i,x=[v,f].join(),n=s+a,l=new q.Template("<menu>",'<li><a class="',j," ",i,'"></a></li>','<li><a class="',j," ",a,'"></a></li>','<tpl for="items">','<li><a class="',j,' {[ $i == parent.activeIndex ? "',g,'" : "',w,'" ]}">{$index}</a></li>',"</tpl>",'<li><a class="',c,'"></a></li>',"</menu>"),y=q.Widget.UI_SRC;MAP_EVENT_INFO={src:y};var u=q.Component.create({NAME:k,ATTRS:{activeIndex:{value:0,setter:"_setActiveIndex"},animationTime:{value:0.5},intervalTime:{value:0.75},itemSelector:{value:">*"},nodeMenu:{value:null,setter:"_setNodeMenu"},nodeMenuItemSelector:{value:s+j},playing:{value:true}},prototype:{animation:null,nodeSelection:null,nodeMenu:null,initializer:function(){var A=this;A.animation=new q.Anim({duration:A.get("animationTime"),to:{opacity:1}});},renderUI:function(){var A=this;A._updateNodeSelection();A.nodeMenu=A.get("nodeMenu");A._updateMenuNodes();},bindUI:function(){var A=this;A.after({activeIndexChange:A._afterActiveIndexChange,animationTimeChange:A._afterAnimationTimeChange,itemSelectorChange:A._afterItemSelectorChange,intervalTimeChange:A._afterIntervalTimeChange,nodeMenuItemSelector:A._afterNodeMenuItemSelectorChange,playingChange:A._afterPlayingChange});A._bindMenu();if(A.get("playing")===true){A._afterPlayingChange({prevVal:false,newVal:true});}},syncUI:function(){var A=this;A._uiSetActiveIndex(A.get("activeIndex"));},item:function(C){var A=this;A.set("activeIndex",C);},next:function(){instance._updateIndexNext();},pause:function(){var A=this;A.set("playing",false);},play:function(){var A=this;A.set("playing",true);},prev:function(){var A=this;A._updateIndexPrev();},_afterActiveIndexChange:function(C){var A=this;A._uiSetActiveIndex(C.newVal,{prevVal:C.prevVal,animate:A.get("playing"),src:C.src});},_afterAnimationTimeChange:function(C){var A=this;A.animation.set("duration",C.newVal);},_afterItemSelectorChange:function(C){var A=this;A._updateNodeSelection();},_afterNodeMenuItemSelectorChange:function(C){var A=this;A.nodeMenuItemSelector=C.newVal;A._updateMenuNodes();},_afterIntervalTimeChange:function(C){var A=this;A._clearIntervalRotationTask();A._createIntervalRotationTask();},_afterPlayingChange:function(E){var A=this;var H=A.nodeMenu.one(x);var D=E.newVal;var G=r;var C=i;var F="_clearIntervalRotationTask";if(D){G=i;C=r;F="_createIntervalRotationTask";}A[F]();if(H){H.replaceClass(G,C);}},_bindMenu:function(){var A=this;var C=A.nodeMenu;var D=A.get("nodeMenuItemSelector");C.delegate("click",A._onClickDelegate,D,A);A.nodeMenuItemSelector=D;},_clearIntervalRotationTask:function(){var A=this;clearInterval(A._intervalRotationTask);},_createIndexRandom:function(){var A=this;return Math.ceil(Math.random()*A.nodeSelection.size())-1;},_createIntervalRotationTask:function(){var A=this;A._clearIntervalRotationTask();A._intervalRotationTask=setInterval(function(){A._updateIndexNext({animate:true});},A.get("intervalTime")*1000);},_onAnimationEnd:function(E,F,D,C,G){var A=this;if(D){D.removeClass(z);}F.setStyle("opacity","1");},_onAnimationStart:function(E,F,D,C,G){var A=this;F.addClass(d);if(C){C.addClass(b);}if(D){D.replaceClass(d,z);}if(G){G.removeClass(b);}},_onClickDelegate:function(D){var A=this;D.preventDefault();var E=D.currentTarget;var C;if(E.hasClass(t)){C=A._onMenuItemClick;}else{if(E.hasClass(a)){C=A._updateIndexPrev;}else{if(E.hasClass(c)){C=A._updateIndexNext;}else{if(E.test(x)){C=A._onMenuPlayClick;}}}}if(C){C.apply(A,arguments);}},_onMenuItemClick:function(D){var A=this;D.preventDefault();var C=A.menuNodes.indexOf(D.currentTarget);A.set("activeIndex",C,MAP_EVENT_INFO);},_onMenuPlayClick:function(C){var A=this;this.set("playing",!this.get("playing"));},_renderMenu:function(){var A=this;var C=l.render({items:A.nodeSelection.getDOM(),activeIndex:A.get("activeIndex")});A.get("contentBox").appendChild(C);return C;},_setActiveIndex:function(C){var A=this;if(C=="rand"){C=A._createIndexRandom();}else{C=Math.max(Math.min(C,A.nodeSelection.size()),-1);}return C;},_setNodeMenu:function(C){var A=this;return q.one(C)||A._renderMenu();},_uiSetActiveIndex:function(D,I){var K=this;var H=null;var F=null;var L=null;var A=null;var J=K.nodeSelection.item(D);var G=K.menuNodes;var C=G.item(D);K.animation.set("node",J);if(I&&!e.isUndefined(I.prevVal)){var E=I.prevVal;J.setStyle("opacity","0");F=G.item(E);H=K.nodeSelection.item(E);H.replaceClass(d,z);K.animation.stop();}else{J.addClass(d);J.setStyle("opacity","1");}L=K.animation.on("start",function(M){K._onAnimationStart(M,J,H,C,F);L.detach();});A=K.animation.on("end",function(M){K._onAnimationEnd(M,J,H,C,F);A.detach();});if(I){if(I.animate){K.animation.run();}else{K.animation.fire("start");K.animation.fire("end");}if(I.src==y&&I.animate){K._createIntervalRotationTask();}}},_updateIndexNext:function(D){var A=this;var C=A.get("activeIndex");var F=A.nodeSelection.size();var E=C+1;if(E>(F-1)){E=0;}D.src=y;A.set("activeIndex",E,D);},_updateIndexPrev:function(D){var A=this;var C=A.get("activeIndex");var E=C-1;if(E<0){E=A.nodeSelection.size()-1;}D.src=y;A.set("activeIndex",E,D);},_updateMenuNodes:function(){var A=this;A.menuNodes=A.nodeMenu.all(h);},_updateNodeSelection:function(){var A=this;var C=A.get("itemSelector");var D=A.get("contentBox").all(C);D.addClass(m);A.nodeSelection=D;},_intervalRotationTask:null}});q.Carousel=u;},"@VERSION@",{requires:["aui-base","aui-template","anim"],skinnable:true});